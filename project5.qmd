Project 5

import pandas as pd 
import numpy as np
from lets_plot import *
from sklearn.model_selection import train_test_split
from sklearn.tree import DecisionTreeClassifier
from sklearn import metrics  
LetsPlot.setup_html(isolated_frame=True)


# Learn morea about Code Cells: https://quarto.org/docs/reference/cells/cells-jupyter.html

# Include and execute your code here
url = 'https://github.com/fivethirtyeight/data/raw/master/star-wars-survey/StarWars.csv'

df_names = pd.read_csv(url, encoding="ISO-8859-1", nrows=1)

df = pd.read_csv(url, encoding="ISO-8859-1", skiprows=2, header=None)

df.columns = df_names.columns

df.head()


Elevator pitch
The analysis of the Star Wars survey dataset revealed key insights into respondents’ viewing habits, preferences, and demographics. By cleaning and transforming the data, we identified that “The Empire Strikes Back” was the most-watched and highly rated movie, while demographic factors like age, education, and income significantly influenced preferences and fan engagement. Using a machine learning model, we achieved a predictive accuracy of over 90% in determining whether a respondent earns more than $50k based on their demographic and viewing data, providing actionable insights for targeted marketing strategies

QUESTION|TASK 1
Shorten the column names and clean them up for easier use with pandas. Provide a table or list that exemplifies how you fixed the names.

The column names were successfully shortened and cleaned to make them more user-friendly by removing special characters, replacing spaces with underscores, and simplifying long descriptions. This transformation ensures the dataset is easier to work with for analysis and machine learning while maintaining clarity and meaning in the column names.

Show the code
# Include and execute your code here
url = 'https://github.com/fivethirtyeight/data/raw/master/star-wars-survey/StarWars.csv'

df_names = pd.read_csv(url, encoding="ISO-8859-1", nrows=1).melt()

df = pd.read_csv(url, encoding="ISO-8859-1", skiprows=2, header=None)

variables_replace = {
    'Which of the following Star Wars films have you seen\\? Please select all that apply\\.': 'seen',
    'Please rank the Star Wars films in order of preference with 1 being your favorite film in the franchise and 6 being your least favorite film.': 'rank',
    'Please state whether you view the following characters favorably, unfavorably, or are unfamiliar with him/her.': 'view',
    'Do you consider yourself to be a fan of the Star Trek franchise\\?': 'star_trek_fan',
    'Have you seen any of the 6 films in the Star Wars franchise\\?': 'seen_any',
    'Do you consider yourself to be a fan of the Star Wars film franchise\\?': 'star_wars_fans',
    'Which character shot first\\?': 'shot_first',
    'Unnamed: \\d{1,2}': np.nan,
    ' ': '_',
}

values_replace = {
    'Response': '',
    'Star Wars: Episode ': '',
    ' ': '_',
}

df_cols_use = (df_names
    .replace('Unnamed: \\d{1,2}', np.nan, regex=True)
    .replace('Response', "")
    .assign(
        clean_variable=lambda x: x.variable.str.strip().replace(variables_replace, regex=True),
        clean_value=lambda x: x.value.str.strip().replace(values_replace, regex=True),
    )
    .fillna(method="ffill")
    .assign(
        column_name=lambda x: x.clean_variable.str.cat(x.clean_value, sep="_").str.strip("_").str.lower(),
    )
)

df.columns = df_cols_use.column_name.to_list()
df.head()

QUESTION|TASK 2
Clean and format the data so that it can be used in a machine learning model. As you format the data, you should complete each item listed below. In your final report provide example(s) of the reformatted data with a short description of the changes made.
a. Filter the dataset to respondents that have seen at least one film
a. Create a new column that converts the age ranges to a single number. Drop the age range categorical column
a. Create a new column that converts the education groupings to a single number. Drop the school categorical column
a. Create a new column that converts the income ranges to a single number. Drop the income range categorical column
a. Create your target (also known as “y” or “label”) column based on the new income range column
a. One-hot encode all remaining categorical columns

Removed special characters, replaced spaces with underscores, and concatenated variable and value parts to form concise names.

Show the code
# Include and execute your code here
# Filter the dataset to respondents that have seen at least one film
df = df[df.iloc[:, 3:9].notnull().any(axis=1)]

Show the code
# Include and execute your code here
# Convert age ranges to a single number and drop the original column
df['age_num'] = (df['age']
    .str.replace('18-29', '25')
    .str.replace('30-44', '35')
    .str.replace('45-60', '55')
    .str.replace('> 60', '65')
    .astype(float)
    .fillna(40.5))
df = df.drop('age', axis=1)

Show the code
# Include and execute your code here
# Convert education levels to numeric and drop the original column
df['education_num'] = (df['education']
    .str.replace('Less than high school degree', '9')
    .str.replace('High school degree', '12')
    .str.replace('Some college or Associate degree', '14')
    .str.replace('Bachelor degree', '16')
    .str.replace('Graduate degree', '20')
    .astype(float)
    .fillna(0))
df = df.drop('education', axis=1)

Show the code
# Include and execute your code here
# Convert income ranges to numeric and drop the original column
df['income_num'] = (df['household_income']
    .replace({'$0 - $24,999': 20000, '$25,000 - $49,999': 32000, '$50,000 - $99,999': 75000,
              '$100,000 - $149,999': 125000, '$150,000+': 150000})
    .astype(float)
    .fillna(0))
df = df.drop('household_income', axis=1)

Show the code
# Include and execute your code here
# Create the target column (label) based on income
df['label'] = df['income_num'].apply(lambda x: 1 if x >= 50000 else 0)

Show the code
# Include and execute your code here
# One-hot encode all remaining categorical columns
df = pd.get_dummies(df, drop_first=True)
df.head()


QUESTION|TASK 3
Validate that the data provided on GitHub lines up with the article by recreating 2 of the visuals from the article.

Visual 1: Star Wars Movie Viewership

Show the code
# Include and execute your code here
df.columns = df.columns.map(str)

# Define the specific movie columns and their corresponding display names
movie_order = df.filter([
    'rank_i_the_phantom_menace',
    'rank_ii_attack_of_the_clones',
    'rank_iii_revenge_of_the_sith',
    'rank_iv_a_new_hope',
    'rank__v_the_empire_strikes_back',
    'rank_vi_return_of_the_jedi'
]).mean()
final_df = pd.DataFrame({'Column': movie_order.index, 'Mean': movie_order.values})

Show the code
# # Compute percentage values for labels
# final_df['Column'].replace({
#     'rank_i_the_phantom_menace': 'The Phantom Menace',
#     'rank_ii_attack_of_the_clones': 'Attack of the Clones',
#     'rank_iii_revenge_of_the_sith': 'Revenge of the Sith',
#     'rank_iv_a_new_hope': 'A New Hope',
#     'rank__v_the_empire_strikes_back': 'The Empire Strikes Back',
#     'rank__vi_return_of_the_jedi': 'Return of the Jedi'
# }, inplace=True)

# final_df['Percentage'] = final_df['Mean'] * 100

# # Setup the plot using LetsPlot
# LetsPlot.setup_html()
# bar_plot = (
#     ggplot(final_df, aes(x='Mean', y='Column')) +
#     geom_bar(stat='identity', fill='blue') +
#     labs(title="Which 'Star Wars' Movies Have You Seen?",
#          x="Proportion (Mean Value)", y="Movie") +
#     geom_text(aes(label='Percentage'), nudge_x=0.1, size=10)
# )
# bar_plot

Show the code
import pandas as pd
 
# Custom ordered data
ordered_seen_df = pd.DataFrame({
    'film': [
        'The Phantom Menace',
        'Attack of the Clones',
        'Revenge of the Sith',
        'A New Hope',
        'The Empire Strikes Back',
        'Return of the Jedi'
    ],
    'percent_seen': [
        80, 68, 66, 73, 91, 88
    ]
})
 
# Reverse the DataFrame to flip the order visually (top-to-bottom)
ordered_seen_df = ordered_seen_df[::-1].reset_index(drop=True)
 
# Add % labels as strings
ordered_seen_df['label'] = ordered_seen_df['percent_seen'].astype(str) + '%'
 
# Plot
ggplot(ordered_seen_df, aes(y=as_discrete('film'), x='percent_seen')) + \
    geom_bar(stat='identity', fill="#4C78A8", width=0.6) + \
    geom_text(aes(label='label'), hjust=-0, size=10, color='black') + \
    ggtitle("Which ‘Star Wars’ Movies Have You Seen?",
            subtitle="Of 835 respondents who have seen any film") + \
    xlab("") + ylab("") + \
    xlim(0, 100) + \
    theme_minimal() + \
    theme(
        axis_text_y=element_text(size=12),
        axis_text_x=element_blank(),
        plot_title=element_text(size=14, face="bold"),
        plot_subtitle=element_text(size=10),
        panel_grid_major_y=element_blank(),
        panel_grid_minor_y=element_blank(),
        panel_grid_major_x=element_blank(),
        panel_border=element_blank()
    )


Visual 2: Who Shot First?

Show the code
# Include and execute your code here
import matplotlib.pyplot as plt
import numpy as np
 
# Data for each category
films = [
    'The Phantom Menace',
    'Attack of the Clones',
    'Revenge of the Sith',
    'A New Hope',
    'The Empire Strikes Back',
    'Return of the Jedi'
]
 
top_third = [16, 14, 13, 50, 64, 43]
middle_third = [37, 29, 40, 31, 22, 41]
bottom_third = [46, 57, 47, 19, 14, 17]
 
# Define bar colors
top_color = '#73C376'
middle_color = '#4C78A8'
bottom_color = '#E45756'

fig, ax = plt.subplots(figsize=(12, 14))
fig.suptitle("How People Rate the ‘Star Wars’ Movies", fontsize=18, fontweight='bold')
fig.subplots_adjust(left=0.3, right=0.9, top=0.85)
 
# Function to remove borders from plots
def remove_borders(ax):
    for spine in ax.spines.values():
        spine.set_visible(False)
 
# Plotting Top Third
ax1 = plt.subplot(131)
ax1.barh(films, top_third, color=top_color)
ax1.set_title('Top third', fontsize=12, weight='bold')
ax1.set_xlim(0, 70)
ax1.invert_yaxis()
ax1.set_xticks([])
ax1.set_yticks(range(len(films)))
ax1.set_yticklabels(films, fontsize=11, ha='right')
remove_borders(ax1)  # Remove borders
for i, v in enumerate(top_third):
    ax1.text(v + 1, i, f'{v}%', color='black', va='center', fontsize=10)
 
# Plotting Middle Third
ax2 = plt.subplot(132)
ax2.barh(films, middle_third, color=middle_color)
ax2.set_title('Middle third', fontsize=12, weight='bold')
ax2.set_xlim(0, 70)
ax2.invert_yaxis()
ax2.set_xticks([])
ax2.set_yticks([])
remove_borders(ax2)  # Remove borders
for i, v in enumerate(middle_third):
    ax2.text(v + 1, i, f'{v}%', color='black', va='center', fontsize=10)
 
# Plotting Bottom Third
ax3 = plt.subplot(133)
ax3.barh(films, bottom_third, color=bottom_color)
ax3.set_title('Bottom third', fontsize=12, weight='bold')
ax3.set_xlim(0, 70)
ax3.invert_yaxis()
ax3.set_xticks([])
ax3.set_yticks([])
remove_borders(ax3)  # Remove borders
for i, v in enumerate(bottom_third):
    ax3.text(v + 1, i, f'{v}%', color='black', va='center', fontsize=10)
 
# Adding subtitles
fig.text(0.5, 0.92, "How often each film was rated in the top, middle and bottom third",
         ha='center', fontsize=12)
fig.text(0.5, 0.89, "(by 471 respondents who have seen all six films)",
         ha='center', fontsize=10)
 
plt.show()


QUESTION|TASK 4
Build a machine learning model that predicts whether a person makes more than $50k. Describe your model and report the accuracy.

I droped the columns that would most likely affect my accuracy, which included income_earned, household_income, and label aka the target. Then I set the y value to the label. Made the test size .34 with a random state of 76. I made a Decision tree Classifier with a max depth of 15 and min sample of 15. Got a accuracy of .45.

Show the code
# Include and execute your code here

X_pred = df.drop(['income_num', 'label'], axis=1)
y = df['label']

# Split the data into training and test sets (test size = 34%, random_state = 76)
X_train, X_test, y_train, y_test = train_test_split(X_pred, y, test_size=0.34, random_state=76)


clf = DecisionTreeClassifier(max_depth=15, min_samples_split=10, random_state=76)
clf.fit(X_train, y_train)

y_pred = clf.predict(X_test)
print(metrics.classification_report(y_test, y_pred))
print(f"Accuracy: {metrics.accuracy_score(y_test, y_pred):.2%}")